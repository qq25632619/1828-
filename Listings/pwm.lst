C51 COMPILER V9.54   PWM                                                                   11/02/2020 09:13:02 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN .\Objects\pwm.obj
COMPILER INVOKED BY: e:\Keil_v5\C51\BIN\C51.EXE pwm.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\pwm.l
                    -st) OBJECT(.\Objects\pwm.obj)

line level    source

   1          /*******************
   2          *
   3          ****HOT1-----P2.5
   4          ****HOT0-----P3.7/PWM0
   5          ****FAN------P2.7
   6          ****LASER----P2.6
   7          ****PD11-----P2.4/PWM3
   8          ****PWM1-----P3.5/PWM1
   9          ****PD12-----P0.1
  10          *
  11          *HOT0   PD11    PWM1                    Ê¹ÓÃÓ²¼þPWM
  12          *HOT1   FAN             LASER   PD12    Ê¹ÓÃ¶¨Ê±Æ÷1À´Ä£ÄâPWM
  13          ***************/
  14          
  15          #include "pwm.h"
  16          
  17          u8 code pwm_frequent_table[256] =                                       //pwmÆµÂÊ±í£¬ÆµÂÊÓÉ¸ßµ½µÍ£¬Ê¹ÓÃÊ±¿ÉÒÔ°´ÐèÇó·´
  18          {
  19                  0xff , 0xfe , 0xfd , 0xfc , 0xfb , 0xfa , 0xf9 , 0xf8 , 0xf7 , 0xf6 , 0xf5 , 0xf4 , 0xf3 , 0xf2 , 0xf1 , 
             -0xf0 , 
  20                  0xef , 0xee , 0xed , 0xec , 0xeb , 0xea , 0xe9 , 0xe8 , 0xe7 , 0xe6 , 0xe5 , 0xe4 , 0xe3 , 0xe2 , 0xe1 , 
             -0xe0 ,
  21                  0xdf , 0xde , 0xdd , 0xdc , 0xdb , 0xda , 0xd9 , 0xd8 , 0xd7 , 0xd6 , 0xd5 , 0xd4 , 0xd3 , 0xd2 , 0xd1 , 
             -0xd0 , 
  22                  0xcf , 0xce , 0xcd , 0xcc , 0xcb , 0xca , 0xc9 , 0xc8 , 0xc7 , 0xc6 , 0xc5 , 0xc4 , 0xc3 , 0xc2 , 0xc1 , 
             -0xc0 , 
  23                  0xbf , 0xbe , 0xbd , 0xbc , 0xbb , 0xba , 0xb9 , 0xb8 , 0xb7 , 0xb6 , 0xb5 , 0xb4 , 0xb3 , 0xb2 , 0xb1 , 
             -0xb0 , 
  24                  0xaf , 0xae , 0xad , 0xac , 0xab , 0xaa , 0xa9 , 0xa8 , 0xa7 , 0xa6 , 0xa5 , 0xa4 , 0xa3 , 0xa2 , 0xa1 , 
             -0xa0 , 
  25                  0x9f , 0x9e , 0x9d , 0x9c , 0x9b , 0x9a , 0x99 , 0x98 , 0x97 , 0x96 , 0x95 , 0x94 , 0x93 , 0x92 , 0x91 , 
             -0x90 , 
  26                  0x8f , 0x8e , 0x8d , 0x8c , 0x8b , 0x8a , 0x89 , 0x88 , 0x87 , 0x86 , 0x85 , 0x84 , 0x83 , 0x82 , 0x81 , 
             -0x80 , 
  27                  0x7f , 0x7e , 0x7d , 0x7c , 0x7b , 0x7a , 0x79 , 0x78 , 0x77 , 0x76 , 0x75 , 0x74 , 0x73 , 0x72 , 0x71 , 
             -0x70 , 
  28                  0x6f , 0x6e , 0x6d , 0x6c , 0x6b , 0x6a , 0x69 , 0x68 , 0x67 , 0x66 , 0x65 , 0x64 , 0x63 , 0x62 , 0x61 , 
             -0x60 , 
  29                  0x5f , 0x5e , 0x5d , 0x5c , 0x5b , 0x5a , 0x59 , 0x58 , 0x57 , 0x56 , 0x55 , 0x54 , 0x53 , 0x52 , 0x51 , 
             -0x50 , 
  30                  0x4f , 0x4e , 0x4d , 0x4c , 0x4b , 0x4a , 0x49 , 0x48 , 0x47 , 0x46 , 0x45 , 0x44 , 0x43 , 0x42 , 0x41 , 
             -0x40 , 
  31                  0x3f , 0x3e , 0x3d , 0x3c , 0x3b , 0x3a , 0x39 , 0x38 , 0x37 , 0x36 , 0x35 , 0x34 , 0x33 , 0x32 , 0x31 , 
             -0x30 , 
  32                  0x2f , 0x2e , 0x2d , 0x2c , 0x2b , 0x2a , 0x29 , 0x28 , 0x27 , 0x26 , 0x25 , 0x24 , 0x23 , 0x22 , 0x21 , 
             -0x20 , 
  33                  0x1f , 0x1e , 0x1d , 0x1c , 0x1b , 0x1a , 0x19 , 0x18 , 0x17 , 0x16 , 0x15 , 0x14 , 0x13 , 0x12 , 0x11 , 
             -0x10 , 
  34                  0x0f , 0x0e , 0x0d , 0x0c , 0x0b , 0x0a , 0x09 , 0x08 , 0x07 , 0x06 , 0x05 , 0x04 , 0x03 , 0x02 , 0x01 , 
             -0x00 ,         
  35          } ; 
  36          
  37          u8 code pwm_width_table[256] =                  //PWM¿í¶È±í£¬¿í¶ÈÓÉ¿íµ½Õ­£¬Ê¹ÓÃÊ±¿ÉÒÔ°´ÐèÇó·´
  38          {
C51 COMPILER V9.54   PWM                                                                   11/02/2020 09:13:02 PAGE 2   

  39                  0xff , 0xfe , 0xfd , 0xfc , 0xfb , 0xfa , 0xf9 , 0xf8 , 0xf7 , 0xf6 , 0xf5 , 0xf4 , 0xf3 , 0xf2 , 0xf1 , 
             -0xf0 , 
  40                  0xef , 0xee , 0xed , 0xec , 0xeb , 0xea , 0xe9 , 0xe8 , 0xe7 , 0xe6 , 0xe5 , 0xe4 , 0xe3 , 0xe2 , 0xe1 , 
             -0xe0 ,
  41                  0xdf , 0xde , 0xdd , 0xdc , 0xdb , 0xda , 0xd9 , 0xd8 , 0xd7 , 0xd6 , 0xd5 , 0xd4 , 0xd3 , 0xd2 , 0xd1 , 
             -0xd0 , 
  42                  0xcf , 0xce , 0xcd , 0xcc , 0xcb , 0xca , 0xc9 , 0xc8 , 0xc7 , 0xc6 , 0xc5 , 0xc4 , 0xc3 , 0xc2 , 0xc1 , 
             -0xc0 , 
  43                  0xbf , 0xbe , 0xbd , 0xbc , 0xbb , 0xba , 0xb9 , 0xb8 , 0xb7 , 0xb6 , 0xb5 , 0xb4 , 0xb3 , 0xb2 , 0xb1 , 
             -0xb0 , 
  44                  0xaf , 0xae , 0xad , 0xac , 0xab , 0xaa , 0xa9 , 0xa8 , 0xa7 , 0xa6 , 0xa5 , 0xa4 , 0xa3 , 0xa2 , 0xa1 , 
             -0xa0 , 
  45                  0x9f , 0x9e , 0x9d , 0x9c , 0x9b , 0x9a , 0x99 , 0x98 , 0x97 , 0x96 , 0x95 , 0x94 , 0x93 , 0x92 , 0x91 , 
             -0x90 , 
  46                  0x8f , 0x8e , 0x8d , 0x8c , 0x8b , 0x8a , 0x89 , 0x88 , 0x87 , 0x86 , 0x85 , 0x84 , 0x83 , 0x82 , 0x81 , 
             -0x80 , 
  47                  0x7f , 0x7e , 0x7d , 0x7c , 0x7b , 0x7a , 0x79 , 0x78 , 0x77 , 0x76 , 0x75 , 0x74 , 0x73 , 0x72 , 0x71 , 
             -0x70 , 
  48                  0x6f , 0x6e , 0x6d , 0x6c , 0x6b , 0x6a , 0x69 , 0x68 , 0x67 , 0x66 , 0x65 , 0x64 , 0x63 , 0x62 , 0x61 , 
             -0x60 , 
  49                  0x5f , 0x5e , 0x5d , 0x5c , 0x5b , 0x5a , 0x59 , 0x58 , 0x57 , 0x56 , 0x55 , 0x54 , 0x53 , 0x52 , 0x51 , 
             -0x50 , 
  50                  0x4f , 0x4e , 0x4d , 0x4c , 0x4b , 0x4a , 0x49 , 0x48 , 0x47 , 0x46 , 0x45 , 0x44 , 0x43 , 0x42 , 0x41 , 
             -0x40 , 
  51                  0x3f , 0x3e , 0x3d , 0x3c , 0x3b , 0x3a , 0x39 , 0x38 , 0x37 , 0x36 , 0x35 , 0x34 , 0x33 , 0x32 , 0x31 , 
             -0x30 , 
  52                  0x2f , 0x2e , 0x2d , 0x2c , 0x2b , 0x2a , 0x29 , 0x28 , 0x27 , 0x26 , 0x25 , 0x24 , 0x23 , 0x22 , 0x21 , 
             -0x20 , 
  53                  0x1f , 0x1e , 0x1d , 0x1c , 0x1b , 0x1a , 0x19 , 0x18 , 0x17 , 0x16 , 0x15 , 0x14 , 0x13 , 0x12 , 0x11 , 
             -0x10 , 
  54                  0x0f , 0x0e , 0x0d , 0x0c , 0x0b , 0x0a , 0x09 , 0x08 , 0x07 , 0x06 , 0x05 , 0x04 , 0x03 , 0x02 , 0x01 , 
             -0x00 , 
  55          } ; 
  56                  
  57          void pwm_init(void) //pwm¶Ë¿Ú³õÊ¼»¯µÈ£¬ÅäÖÃ³õÊ¼ÆµÂÊ£¬³õÊ¼ÖµµÈµÈÐÅÏ¢¡£4¸ö²½Öè×îÖØÒª
  58          {
  59   1      /**/    CMOD = 0x04 ; //£¬¿ÕÏÐÄ£Ê½ÏÂ¼ÆÊýÆ÷±£³Ö¹¤×÷£¬PCA¼ÆÊýÆ÷Ê±ÖÓÎª¶¨Ê±Æ÷0Òç³öÂÊ£¬ÇÒ½ûÖ¹PCA¼ÆÊýÆ÷ÖÐ¶Ï
  60   1                      CCON = 0 ; //Çå³ý¸÷ÖÖÖÐ¶Ï±êÖ¾Î»£¬ÇÒ¹Ø±ÕCRÎ»£¨¼ÆÊýÆ÷Ê¹ÄÜÎ»£©
  61   1                      CH = CL = 0 ; //¸ßµÍÁ½¼ÆÊýÆ÷³õÖµÎª0 
  62   1              
  63   1      /**/    CCAP0H = CCAP0L = 0x80 ; //±È½ÏÖµ£¬Ò²¾ÍÊÇÕ¼¿Õ±È×î¸ù±¾À´Ô´                                                       //PWM0 
  64   1      /**/    CCAPM0= 0x42 ; //Ê¹ÄÜ±È½ÏÆ÷¹¦ÄÜ£¬ÉèÖÃÎªPWMÄ£Ê½£¬½ûÖ¹PWMÖÐ¶ÏÊ¹ÄÜ
  65   1      
  66   1                      CCAP1H = CCAP1L = 0x08 ;                                                                                                                        //PWM1
  67   1                      CCAPM0 = 0x42 ; 
  68   1              
  69   1                      CCAP3H = CCAP3L = 0x07 ;                                                                                                                        //PWM3
  70   1                      CCAPM3 = 0x42 ; 
  71   1              
  72   1      /**/    CR = 1 ; //Ê¹ÄÜPCA¼ÆÊýÆ÷£¨¸ÃÎ»ÔÚCCONÖÐ£©
  73   1      }
  74          
  75          
  76          //ÒÔÏÂÎª¸÷Â·PWMÕ¼¿Õ±È¼°ÆµÂÊ¸üÐÂº¯Êý£¬ÎÊ£ºµ¥Æ¬»úÖÐ4Â·PWM¹«ÓÃÍ¬Ò»¶¨Ê±Æ÷£¬ÊÇ·ñÓÐÉèÖÃÆµÂÊ¸üÐÂµÄ±ØÒª£¿£¿£¿
  77          void pwm_update_for_hot0_pwm0(u8 freq_for_pwm0 , u8 pwm_width_for_pwm0)  //°¬¾Ä¼ÓÈÈPWM¸üÐÂ£¬²ÎÊýÒ»ÎªÕ¼¿Õ±È
             -£¬²ÎÊý¶øÎªÆµÂÊ
  78          {
  79   1              TH0 = TL0 = freq_for_pwm0 ; 
  80   1              CCAP0H = CCAP0L = pwm_width_for_pwm0 ; 
  81   1      }
  82          
  83          void pwm_update_for_pd11(u8 freq_for_pd11 , u8 pwm_width_for_pd11)//×ãÁÆPWM¸üÐÂ£¬²ÎÊýÒ»ÎªÕ¼¿Õ±È£¬²ÎÊý¶þÎªÆ
C51 COMPILER V9.54   PWM                                                                   11/02/2020 09:13:02 PAGE 3   

             -µÂÊ
  84          {
  85   1              frequent_update_all = freq_for_pd11 ; 
  86   1              CCAP3H = CCAP3L = pwm_width_for_pd11 ; 
  87   1      }
  88          
  89          void pwm_update_for_pwm1(u8 freq_for_pwm1 , u8 pwm_width_for_pwm1)//¼¤¹âPWM¸üÐÂ£¬²ÎÊýÒ»ÎªÕ¼¿Õ±È£¬²ÎÊý¶þÎªÆ
             -µÂÊ
  90          {
  91   1              frequent_update_all = freq_for_pwm1 ; 
  92   1              CCAP1H = CCAP1L = pwm_width_for_pwm1 ; 
  93   1      }
  94          
  95          //void pwm_update_for_fan(u8 pwm_width_for_fan , u8 freq_for_fan)//·çÉÈPWM¸üÐÂ£¬²ÎÊýÒ»ÎªÕ¼¿Õ±È£¬²ÎÊý¶þÎªÆµ
             -ÂÊ
  96          //{
  97          //      frequent_update_all = freq_for_fan ; 
  98          //      CCAP0H = CCAP0L = pwm_width_for_fan ; 
  99          //}
 100          
 101          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     69    ----
   CONSTANT SIZE    =    512    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
