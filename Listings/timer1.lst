C51 COMPILER V9.54   TIMER1                                                                11/02/2020 09:13:01 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TIMER1
OBJECT MODULE PLACED IN .\Objects\timer1.obj
COMPILER INVOKED BY: e:\Keil_v5\C51\BIN\C51.EXE timer1.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ti
                    -mer1.lst) OBJECT(.\Objects\timer1.obj)

line level    source

   1          #include "timer1.h"
   2          
   3          u8 flag1 , flag2 ;  //Á½¸öÈí¶¨Ê±±êÖ¾Î»£¬Ç°ÕßÎªLEDÁÁµÄÊ±¼ä¶Î£¬ºóÕßÎªÃð
   4          u16 soft_timer_counter  , led_on_time , led_off_time ; //Èí¶¨Ê±×ÔÔö±äÁ¿£¬ledÁÁÊ±¼ä£¬LEDÃðÊ±¼ä
   5          u8 adc_translate_delay = 0 ;
   6          
   7          u16 key_3_delay = 0 ; 
   8          u8 time_add_delay = 0 ; 
   9          
  10          
  11          void timer0_init(void) ; //¶¨Ê±Æ÷0³õÊ¼»¯
  12          void set_timer(u16 led_on_time_temp , u16 led_off_time_temp , VOID funtion1 , VOID funtion2) ;
  13          VOID funtion_run ; 
  14          
  15          u16 time_display_delay = 0 ; 
  16          
  17          /*****************************************
  18          *****************************************/
  19          void timer1_init(void)  //¶¨Ê±Æ÷0³õÊ¼»¯
  20          {
  21   1              TMOD = 0x10 ; 
  22   1      //        TH1 = 0xfa ;  //1ms,12T
  23   1      //        TL1 = 0xca ;
  24   1              
  25   1      //              TH1 = 0xc1 ;  //1ms,1T
  26   1      //              TL0 = 0x80 ;
  27   1              
  28   1                      TH0 = 0xf8 ; //125uS in 1T
  29   1                      TL0 = 0x30 ; 
  30   1              
  31   1              ET1 = 1 ; 
  32   1              EA = 1 ; 
  33   1              
  34   1              TR1 = 1 ; 
  35   1      }
  36          
  37          
  38          void set_timer(u16 led_on_time_temp , u16 led_off_time_temp , VOID funtion1 , VOID funtion2) 
  39          {      
  40   1              led_on_time = led_on_time_temp ; 
  41   1              led_off_time = led_off_time_temp ;
  42   1              
  43   1              if(flag1 == 1)
  44   1              {
  45   2                      flag1 = 0 ; 
  46   2                      funtion_run = funtion1 ; //Ö¸ÕëÖ¸ÏòÁÁº¯Êý
  47   2                      funtion_run() ;                  //²¢ÔËÐÐËùÖ¸ÏòµÄº¯Êý
  48   2              }
  49   1              if(flag2 == 1)
  50   1              {
  51   2                      flag2 = 0 ;
  52   2                      funtion_run = funtion2 ; //Ö¸ÕëÖ¸ÏòÃðº¯Êý
  53   2                      funtion_run() ;                  //²¢ÔËÐÐËùÖ¸ÏòµÄº¯Êý
  54   2              }
C51 COMPILER V9.54   TIMER1                                                                11/02/2020 09:13:01 PAGE 2   

  55   1                      flag_led = 0 ;
  56   1      }
  57          
  58          /*****************************************
  59          *****************************************/
  60          void timer1_interrupt(void) interrupt 3  //¶¨Ê±Æ÷1ÖÐ¶Ïº¯Êý£¬1msÖÐ¶Ï
  61          {
  62   1              #if 0 
                      static u16 tt = 0 , pwm_tt = 0 ; 
              //        TR1 = 0 ;
              //        TH1 = 0xfa ; 
              //        TL1 = 0xca ; 
              //              TR1 = 1 ; 
                      
                     if(++tt >= 20) //20ms½øÐÐÒ»´ÎÉ¨Ãè
                      {
                              tt = 0 ; 
                              key_scan() ; 
                                              key_process_display() ; //Ö÷ÒªÎª°´¼ü¸Ä±äµÄÈ«¾Ö±äÁ¿
                      }       
                              
                              ++time_display_delay ; 
                              display_time() ; 
              ////            if(++time_display_delay >= display_delay) //¶¯Ì¬ÊýÂë¹ÜÑÓÊ±×ÔÔö±äÁ¿
              //              {                       
              //                      display_time() ;
              //                      time_display_delay = 0 ; 
              //              }
                      
                              if(time_control_flag == 1)
                                      time_add_delay++ ; 
                      
                    
              
              //              if(flag_led)
              //              {
                                      if(++soft_timer_counter >= (led_on_time+led_off_time)) //ÁÁÃðµÄÊ±¼ä£¬Í¬Ê±Ò²ÈÝÒ×¿´³öÕ¼¿Õ±È¼´on/£¨on+off£
             -©£¬ÒÔ¼°ÆµÂÊ¼´1000/(on+off)
                                                      soft_timer_counter = 0 ;         //Çå0        
                                      if(soft_timer_counter < led_on_time)  
                                      {
                                                      flag1 = 1 ;
                      //                              led_on() ; 
                                      }                       
                                      else      
                                      {
                                                      flag2 = 1 ;
                      //                              led_off() ; 
                                      }
              //              }
                              
              //              if(++pwm_tt >= 60000)
              //                      pwm_tt = 0 ; 
                              if(pwm_tt >= 5000)
                                      laser = 1 ; 
                              else 
                                      laser = 0 ; 
              
                              if(flag_key_3)
                                      key_3_delay++ ; 
                              
                          TH1 = 0xc1 ; 
C51 COMPILER V9.54   TIMER1                                                                11/02/2020 09:13:01 PAGE 3   

                      TL1 = 0x80 ; 
                              
              //        TH1 = 0xfa ;  //1ms,12T
              //        TL1 = 0xca ;  
                      #endif
 121   1                      
 122   1             static u16 tt = 0 , pwm_tt = 0 ; 
 123   1              
 124   1             if(++tt >= 20) //20ms½øÐÐÒ»´ÎÉ¨Ãè
 125   1              {
 126   2                      tt = 0 ; 
 127   2                      key_scan() ; 
 128   2                                      key_process_display() ; //Ö÷ÒªÎª°´¼ü¸Ä±äµÄÈ«¾Ö±äÁ¿
 129   2              }       
 130   1                      
 131   1                      ++time_display_delay ; 
 132   1                      display_time() ; 
 133   1              
 134   1                      if(time_control_flag == 1)
 135   1                              time_add_delay++ ; 
 136   1              
 137   1            
 138   1      
 139   1                              if(++soft_timer_counter >= (led_on_time+led_off_time)) //ÁÁÃðµÄÊ±¼ä£¬Í¬Ê±Ò²ÈÝÒ×¿´³öÕ¼¿Õ±È¼´on/£¨on+off£
             -©£¬ÒÔ¼°ÆµÂÊ¼´1000/(on+off)
 140   1                                              soft_timer_counter = 0 ;         //Çå0        
 141   1                              if(soft_timer_counter < led_on_time)  
 142   1                              {
 143   2                                              flag1 = 1 ;
 144   2                              }                       
 145   1                              else      
 146   1                              {
 147   2                                              flag2 = 1 ;
 148   2                              }
 149   1                      
 150   1                      if(pwm_tt >= 5000)
 151   1                              laser = 1 ; 
 152   1                      else 
 153   1                              laser = 0 ; 
 154   1      
 155   1                      if(flag_key_3)
 156   1                              key_3_delay++ ; 
 157   1                      
 158   1                  TH1 = 0xf8 ; 
 159   1              TL1 = 0x30 ; 
 160   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    252    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
